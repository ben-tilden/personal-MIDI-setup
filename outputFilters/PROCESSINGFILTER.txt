# processing filter

# option to add chromatic playing for only one part of the drum
# option to add pitch to individual parts for beats 
# option to add slapback

IF LOAD
  # uncomment (and add more) to further set up information here
  # SET Q2 +H
  # SET Q3 +H
  # SET Q7 +H
  # see 1.
  ALIAS I0 padMode
  ASS padMode = 0
  # see 2.
  SET Q3 DRUM_TRACKING 0 2 +MENU
  # see 3.
  ASS J0 = 0
  ASS J1 = 0
  ASS J2 = 0
  ASS J3 = 0
  # see 7.
  ASS K1 = 7E # remote control event
  ASS K2 = 0
  SET Q0 INTERVAL $-12 $12
  ASS Q0 = 0 # current fixed interval level
END

# sysex reception

# init
IF M0 == F0
  IF M2 == 1C
    # uncomment (and add more) to further set up information here
    # SET Q2 +H
    # SET Q3 +H
    # SET Q7 +H
    # see 1.
    ASS padMode = 0
    # see 2.
    SET Q3 DRUM_TRACKING 0 2 +MENU
    # see 3.
    ASS J0 = 0
    ASS J1 = 0
    ASS J2 = 0
    ASS J3 = 0
    # see 7.
    ASS K1 = 7E # remote control event
    ASS K2 = 0
    SET Q0 INTERVAL $-12 $12
    ASS Q0 = 0 # current fixed interval level
    # TEST
    LOG LOCAL_SETUP_RESET
    # END TEST
    BLOCK
    EXIT
  END
END

# 1. switch MIDI from Beats

# sysex reception

IF M0 == F0
  IF M2 == 0C
    ASS padMode = M3
    # TEST
    # ensure localsetup receives padMode
    LOG padMode_SYSEX_RECEIVED padMode
    # END TEST
    BLOCK
    EXIT
  END
END

# if padMode is one, block channel 10 24 - 2C and 30
IF padMode == 1
  N9 24-2C = XX XX +B
  N9 30 = XX XX +B
END

# 3. chromaticize keys volca drum

# sysex reception

IF M0 == F0
  IF M2 == 1F
    ASS Q3 = M3
    # TEST
    # ensure localsetup receives trackingMode
    LOG trackingMode_SYSEX_RECEIVED Q3
    # END TEST
    BLOCK
    EXIT
  END
END

# if tracking is on
IF Q3 != 0
  # if M0 is a note in the current channel, send the channel (J1), pitch control, and note number (J0)
  MAT J2 = MC + 90
  IF M0 == J2
    IF M0 < 96
      MAT J0 = MC + B0
      MAT J1 = M1 + 1
      # if tracking is set to 1 part
      IF Q3 == 1
        SND J0 1C J1
      ELSE
        # I0 is divided into 25 separate groups, ranging 5 values from -12 to +12 semitones (with quantized pitch)
        # J3 has the potential to send messages which will cause issues if it goes below zero / above 126
        # including conditionals to prevent this
        IF I0 < $6
          MAT J3 = J1 - 18
          IF J3 > 0
            SND J0 1A J1
            SND J0 1B J3
          ELSE
            SND J0 1A J1
            SND J0 1B 01
          END
        END
        IF I0 < $11
          IF I0 >= $6
            MAT J3 = J1 - 16
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $16
          IF I0 >= $11
            MAT J3 = J1 - 14
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $21
          IF I0 >= $16
            MAT J3 = J1 - 12
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $26
          IF I0 >= $21
            MAT J3 = J1 - 10
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $31
          IF I0 >= $26
            MAT J3 = J1 - E
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $36
          IF I0 >= $31
            MAT J3 = J1 - C
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $41
          IF I0 >= $36
            MAT J3 = J1 - A
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $46
          IF I0 >= $41
            MAT J3 = J1 - 8
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $51
          IF I0 >= $46
            MAT J3 = J1 - 6
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $56
          IF I0 >= $51
            MAT J3 = J1 - 4
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $61
          IF I0 >= $56
            MAT J3 = J1 - 2
            IF J3 > 0
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 01
            END
          END
        END
        IF I0 < $67
          IF I0 >= $61
            SND J0 1A J1
            SND J0 1B J1
          END
        END
        IF I0 < $72
          IF I0 >= $67
            MAT J3 = J1 + 2
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $77
          IF I0 >= $72
            MAT J3 = J1 + 4
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $82
          IF I0 >= $77
            MAT J3 = J1 + 6
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $87
          IF I0 >= $82
            MAT J3 = J1 + 8
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $92
          IF I0 >= $87
            MAT J3 = J1 + A
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $97
          IF I0 >= $92
            MAT J3 = J1 + C
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $102
          IF I0 >= $97
            MAT J3 = J1 + E
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $107
          IF I0 >= $102
            MAT J3 = J1 + 10
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $112
          IF I0 >= $107
            MAT J3 = J1 + 12
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $117
          IF I0 >= $112
            MAT J3 = J1 + 14
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 < $122
          IF I0 >= $117
            MAT J3 = J1 + 16
            IF J3 < 127
              SND J0 1A J1
              SND J0 1B J3
            ELSE
              SND J0 1A J1
              SND J0 1B 7E
            END
          END
        END
        IF I0 >= $122
          MAT J3 = J1 + 18
          IF J3 < 127
            SND J0 1A J1
            SND J0 1B J3
          ELSE
            SND J0 1A J1
            SND J0 1B 7E
          END
        END
      END
    END
  END
END

# 7. interval setter

# knob 7 has already been deassigned to K1 to allow for interval level

# handle remote control of interval level
IF M0 < B6
  IF M1 == K1
    ASS I0 = M2 # assign interval
    # I0 is divided into 25 separate groups, ranging 5 values from -12 to +12 semitones (with quantized pitch)
    IF I0 < $6
      ASS Q0 = $-12
    END
    IF I0 < $11
      IF I0 >= $6
        ASS Q0 = $-11
      END
    END
    IF I0 < $16
      IF I0 >= $11
        ASS Q0 = $-10
      END
    END
    IF I0 < $21
      IF I0 >= $16
        ASS Q0 = $-9
      END
    END
    IF I0 < $26
      IF I0 >= $21
        ASS Q0 = $-8
      END
    END
    IF I0 < $31
      IF I0 >= $26
        ASS Q0 = $-7
      END
    END
    IF I0 < $36
      IF I0 >= $31
        ASS Q0 = $-6
      END
    END
    IF I0 < $41
      IF I0 >= $36
        ASS Q0 = $-5
      END
    END
    IF I0 < $46
      IF I0 >= $41
        ASS Q0 = $-4
      END
    END
    IF I0 < $51
      IF I0 >= $46
        ASS Q0 = $-3
      END
    END
    IF I0 < $56
      IF I0 >= $51
        ASS Q0 = $-2
      END
    END
    IF I0 < $61
      IF I0 >= $56
        ASS Q0 = $-1
      END
    END
    IF I0 < $67
      IF I0 >= $61
        ASS Q0 = $0
      END
    END
    IF I0 < $72
      IF I0 >= $67
        ASS Q0 = $1
      END
    END
    IF I0 < $77
      IF I0 >= $72
        ASS Q0 = $2
      END
    END
    IF I0 < $82
      IF I0 >= $77
        ASS Q0 = $3
      END
    END
    IF I0 < $87
      IF I0 >= $82
        ASS Q0 = $4
      END
    END
    IF I0 < $92
      IF I0 >= $87
        ASS Q0 = $5
      END
    END
    IF I0 < $97
      IF I0 >= $92
        ASS Q0 = $6
      END
    END
    IF I0 < $102
      IF I0 >= $97
        ASS Q0 = $7
      END
    END
    IF I0 < $107
      IF I0 >= $102
        ASS Q0 = $8
      END
    END
    IF I0 < $112
      IF I0 >= $107
        ASS Q0 = $9
      END
    END
    IF I0 < $117
      IF I0 >= $112
        ASS Q0 = $10
      END
    END
    IF I0 < $122
      IF I0 >= $117
        ASS Q0 = $11
      END
    END
    IF I0 >= $122
      ASS Q0 = $12
    END
  END
END
