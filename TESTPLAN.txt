# test plan

# xtouch

IF LOAD

  ASS G0 = 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

  # local
  ALIAS I0 tempoMode
  ALIAS I1 arpValueMode

  # global
  ALIAS G0 channel
  ALIAS G2 arpPhraseToggle
  ALIAS G3 arpPhraseOnOffToggle
  ALIAS G4 tempoModeMod
  ALIAS G5 tempoPulse
  ALIAS G6 gate
  ALIAS G7 arpValueModeMod
  ALIAS G8 setPhrase
  ALIAS G9 waveguideToggle
  ALIAS GA drumParams
  ALIAS GE arpModeSwitched # gateOpened

  # assign local
  # NOTE if this isn't reset on each 'install', then it's technically possible it could increase to the value max
  ASS tempoMode = 0
  # NOTE if this isn't reset on each 'install', then it's technically possible it could decrease/increase to the value min/max
  ASS arpValueMode = 8000
END

# if it is a button push
IF MT == 90
	# if it is a knob 1 button push, increase tempo mode
	# if variable is too high, reset
	IF M1 == 00 7F
		MATH tempoMode = tempoMode + 1
		# set tempo mode to variable modulo 3
		MATH tempoModeMod = tempoMode % 4
		IF tempoModeMod == 0
			ASS tempoPulse = 24
			SEND BA 01 28
		END
		# set each tempoPulse to default value on switching
		# also send data to xtouch to reflect this
		IF tempoModeMod == 1
			ASS tempoPulse = 24
			SEND BA 01 0
		END
		IF tempoModeMod == 2
			ASS tempoPulse = 24
			SEND BA 01 53
		END
		IF tempoModeMod == 3
			ASS tempoPulse = 18
			SEND BA 01 53
		END
		# TEST
		LOG tempoModeMod tempoModeMod
		LOG tempoPulse tempoPulse
		# END TEST
	END

	# if it is a button 1 push
	IF M0 == 9A 08 7F
		# if arp then increase variable
		IF arpPhraseToggle == 0
			MATH arpValueMode = arpValueMode + 1
			# set value mode to variable modulo 11
			MATH arpValueModeMod = arpValueMode % B
			# NOTE uncommenting this makes clockNum, isOctave, and arpIndex reset whenever the arpMode changes
			# ASS arpModeSwitched = 1
		# if phrase then toggle setPhrase
		ELSE
			IF setPhrase == 0
				ASS setPhrase = 1
				SEND 90 00 01
			ELSE
				ASS setPhrase = 0
				SEND F0 BB BB 07 +F
			END
		END
		# TEST
		LOG arpValueMode arpValueModeMod
		LOG setPhrase setPhrase
		# END TEST
	END

	# if it is a button 9 push
	IF M0 == 9A 10 7F
		# if arp then decrease variable
		IF arpPhraseToggle == 0
			MATH arpValueMode = arpValueMode - 1
			# set value mode to variable modulo 11
			MATH arpValueModeMod = arpValueMode % B
		# if phrase then add rest to phrase sequence
		ELSE
		  SEND F0 AA AA F7 +F
		  # TEST
		  LOG REST_SYSEX_SENT
		  # END TEST
		END
		# TEST
		LOG arpValueMode arpValueModeMod
		# END TEST
	END

	# if it is a button 2 push toggle arp / phrase
	IF M1 == 09 7F
		IF arpPhraseToggle == 0
			ASS arpPhraseToggle = 1
			SEND 90 01 01
		ELSE
			ASS arpPhraseToggle = 0
			IF setPhrase == 1
				ASS setPhrase = 0
				SEND 90 00 00
				SEND F0 BB BB 07 +F
			END
		END
		# TEST
		IF arpPhraseToggle == 0
			LOG IS_ARP
		END
		IF arpPhraseToggle == 1
			LOG IS_PHRASE
		END
		LOG setPhrase setPhrase
		# END TEST
	END

	# if it is a button 10 push toggle button 2 selection on / off
	IF M1 == 11 7F
		IF arpPhraseOnOffToggle == 0
			ASS arpPhraseOnOffToggle = 1
			SEND 90 09 01
		ELSE
			ASS arpPhraseOnOffToggle = 0
		END
		# TEST
		IF arpPhraseOnOffToggle == 0
			LOG MODULE_OFF
		END
		IF arpPhraseOnOffToggle == 1
			LOG MODULE_ON
		END
		# END TEST
	END

	# if it is channel 1-6
	IF channel <= 6
		IF M1 == 07 7F
			IF waveguideToggle == 0
				ASS waveguideToggle = 1
			ELSE
				ASS waveguideToggle = 0
			END
			# TEST
			IF waveguideToggle == 0
				LOG WAVEGUIDE_STRING
			END
			IF waveguideToggle == 1
				LOG WAVEGUIDE_TUBE
			END
			# END TEST
		END
		# for all except the last, order is part 1, part 2, part 1 and 2
		# if it is button 5 - knobs control 'select'
		IF M1 == 0C 7F
			ASS drumParams = $14 $15 $16
			# TEST
			LOG drumParams drumParams
			# END TEST
		END
		# if it is button 6 - knobs control 'level'
		IF M1 == 0D 7F
			ASS drumParams = $17 $18 $19
			# TEST
			LOG drumParams drumParams
			# END TEST
		END
		# if it is button 7 - knobs control 'attack'
		IF M1 == 0E 7F
			ASS drumParams = $20 $21 $22
			# TEST
			LOG drumParams drumParams
			# END TEST
		END
		# if it is button 8 - knobs control 'release'
		IF M1 == 0F 7F
			ASS drumParams = $23 $24 $25
			# TEST
			LOG drumParams drumParams
			# END TEST
		END
		# if it is button 13 - knobs control 'pitch'
		IF M1 == 14 7F
			ASS drumParams = $26 $27 $28
			# TEST
			LOG drumParams drumParams
			# END TEST
		END
		# if it is button 14 - knobs control 'modAmount'
		IF M1 == 15 7F
			ASS drumParams = $29 $30 $31
			# TEST
			LOG drumParams drumParams
			# END TEST
		END
		# if it is button 15 - knobs control 'modRate'
		IF M1 == 16 7F
			ASS drumParams = $46 $47 $48
			# TEST
			LOG drumParams drumParams
			# END TEST
		END
		# order is decay, body, tune, send
		# if it is button 16 - knobs control 'waveguide'
		IF M1 == 17 7F
			ASS drumParams = $17 $18 $19 $103
			# TEST
			LOG drumParams drumParams
			# END TEST
		END
	END
END

# if it is a button note-off (important for lighting)
IF MT == 80
	IF M1 == 08 00
		IF arpPhraseToggle == 1
			IF setPhrase == 1
				SEND 90 00 01
			END
		END
	END

	IF M1 == 09 00
		IF arpPhraseToggle == 1
			SEND 90 01 01
		ELSE
			IF setPhrase == 0
				SEND 90 07 00
			END
		END
	END

	IF M1 == 11 00
		IF arpPhraseOnOffToggle == 1
			SEND 90 09 01
		END
	END
END

# if it is a knob turn
IF MT == B0
	# if knob is 1 (tempo)
	IF M1 == 1
		IF arpPhraseOnOffToggle == 1
			# if arp tempo mode is 0
			IF tempoModeMod == 0
				# if knob value is 0-11
				IF M2 < 12
					ASS tempoPulse = $48
				END
				# if knob value is 12-22
				IF M2 >= 12
					IF M2 < 23
						ASS tempoPulse = $36
					END
				END
				# if knob value is 23-33
				IF M2 >= 23
					IF M2 < 34
						ASS tempoPulse = $24
					END
				END
				# if knob value is 34-45
				IF M2 >= 34
					IF M2 < 46
						ASS tempoPulse = $18
					END
				END
				# if knob value is 46-57
				IF M2 >= 46
					IF M2 < 58
						ASS tempoPulse = $12
					END
				END
				# if knob value is 58-69
				IF M2 >= 58
					IF M2 < 70
						ASS tempoPulse = $9
					END
				END
				# if knob value is 70-81
				IF M2 >= 70
					IF M2 < 82
						ASS tempoPulse = $6
					END
				END
				# if knob value is 82-93
				IF M2 >= 82
					IF M2 < 94
						ASS tempoPulse = $4
					END
				END
				# if knob value is 94-104
				IF M2 >= 94
					IF M2 < 105
						ASS tempoPulse = $3
					END
				END
				# if knob value is 105-115
				IF M2 >= 105
					IF M2 < 116
						ASS tempoPulse = $2
					END
				END
				# if knob value is 116-127
				IF M2 >= 116
					ASS tempoPulse = $1
				END
			END
			# if arp tempo mode is 1
			IF tempoModeMod == 1
				# if knob value is 0-21
				IF M2 < 22
					ASS tempoPulse = $24
				END
				# if knob value is 22-42
				IF M2 >= 22
					IF M2 < 43
						ASS tempoPulse = $12
					END
				END
				# if knob value is 43-63
				IF M2 >= 43
					IF M2 < 64
						ASS tempoPulse = $9
					END
				END
				# if knob value is 64-84
				IF M2 >= 64
					IF M2 < 85
						ASS tempoPulse = $6
					END
				END
				# if knob value is 85-105
				IF M2 >= 85
					IF M2 < 106
						ASS tempoPulse = $4
					END
				END
				# if knob value is 106-127
				IF M2 >= 106
					ASS tempoPulse = $3
				END
			END
			# if arp tempo mode is 2
			IF tempoModeMod == 2
				# if knob value is 0-21
				IF M2 < 22
					ASS tempoPulse = $96
				END
				# if knob value is 22-42
				IF M2 >= 22
					IF M2 < 43
						ASS tempoPulse = $48
					END
				END
				# if knob value is 43-63
				IF M2 >= 43
					IF M2 < 64
						ASS tempoPulse = $24
					END
				END
				# if knob value is 64-84
				IF M2 >= 64
					IF M2 < 85
						ASS tempoPulse = $12
					END
				END
				# if knob value is 85-105
				IF M2 >= 85
					IF M2 < 106
						ASS tempoPulse = $6
					END
				END
				# if knob value is 106-127
				IF M2 >= 106
					ASS tempoPulse = $3
				END
			END
			# if arp tempo mode is 3
			IF tempoModeMod == 3
				# if knob value is 0-21
				IF M2 < 22
					ASS tempoPulse = $72
				END
				# if knob value is 22-42
				IF M2 >= 22
					IF M2 < 43
						ASS tempoPulse = $36
					END
				END
				# if knob value is 43-63
				IF M2 >= 43
					IF M2 < 64
						ASS tempoPulse = $18
					END
				END
				# if knob value is 64-84
				IF M2 >= 64
					IF M2 < 85
						ASS tempoPulse = $9
					END
				END
				# if knob value is 85-105
				IF M2 >= 85
					IF M2 < 106
						ASS tempoPulse = $4
					END
				END
				# if knob value is 106-127
				IF M2 >= 106
					ASS tempoPulse = $2
				END
			END
		END
	END
	# if knob is 2 (gate)
	# starting points: max will be ~5 seconds (5000), min will be .1 seconds (100)
	IF M1 == 2
		MATH gate = M3 * 39
		MATH gate = gate + 100
	END
END
